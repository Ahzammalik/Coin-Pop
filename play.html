<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earn PKR - Coin Pop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        #game-area { width: 100%; height: 65vh; background: #0f172a; position: relative; overflow: hidden; border-radius: 1rem; border: 4px solid #334155; }
        .target-coin { position: absolute; width: 50px; height: 50px; background: radial-gradient(circle, #fcd34d 0%, #d97706 100%); border-radius: 50%; border: 2px solid #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px #fbbf24; }
        .life-heart { color: #ef4444; font-size: 1.5rem; margin-right: 5px; }
        #game-over { display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 50; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="max-w-4xl mx-auto p-4">
        <header class="flex justify-between items-center mb-4 bg-white p-4 rounded-xl shadow-sm">
            <div class="flex items-center">
                <span class="mr-3 font-bold text-gray-500">LIVES:</span>
                <div id="lives-container" class="flex">
                    <i class="fas fa-heart life-heart"></i><i class="fas fa-heart life-heart"></i><i class="fas fa-heart life-heart"></i>
                </div>
            </div>
            <div class="text-xl font-black text-green-600">
                Balance: Rs. <span id="pkr-balance">0.00</span>
            </div>
        </header>

        <div id="game-area">
            <div id="game-over">
                <h2 class="text-4xl font-black mb-2 text-red-500">OUT OF LIVES!</h2>
                <p class="mb-6 text-gray-400">Earned in this session: Rs. <span id="session-pkr">0.00</span></p>
                <button onclick="watchAd()" class="bg-indigo-600 px-8 py-3 rounded-full font-bold mb-4 w-64">WATCH AD TO CONTINUE</button>
                <button onclick="location.href='dashboard.html'" class="text-gray-500 underline">Back to Dashboard</button>
            </div>
            <div id="start-screen" class="absolute inset-0 flex items-center justify-center z-10 bg-slate-900/80">
                <button onclick="startGame()" class="bg-green-600 text-white px-10 py-4 rounded-xl text-2xl font-black shadow-2xl hover:scale-105 transition">START EARNING PKR</button>
            </div>
        </div>
    </div>

    <script>
        let pkrBalance = parseFloat(localStorage.getItem('userPKR') || 0);
        let lives = 3;
        let gameActive = false;
        document.getElementById('pkr-balance').innerText = pkrBalance.toFixed(2);

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            gameActive = true;
            spawnTarget();
        }

        function spawnTarget() {
            if (!gameActive) return;
            const area = document.getElementById('game-area');
            const target = document.createElement('div');
            target.className = 'target-coin';
            target.style.left = Math.random() * (area.offsetWidth - 60) + 'px';
            target.style.top = Math.random() * (area.offsetHeight - 60) + 'px';
            target.innerHTML = '<i class="fas fa-bolt text-white"></i>';

            // HARD MODE: 700ms to 400ms speed
            let speed = Math.max(400, 700 - (pkrBalance * 2));
            
            let clicked = false;
            target.onclick = () => {
                clicked = true;
                updatePKR(0.05); // 0.05 PKR per click (20 clicks = 1 PKR)
                target.remove();
                spawnTarget();
            };
            area.appendChild(target);

            setTimeout(() => {
                if (!clicked) {
                    target.remove();
                    lives--;
                    updateLivesUI();
                    if (lives > 0) spawnTarget(); else gameOver();
                }
            }, speed);
        }

        function updatePKR(amount) {
            pkrBalance += amount;
            localStorage.setItem('userPKR', pkrBalance.toFixed(2));
            document.getElementById('pkr-balance').innerText = pkrBalance.toFixed(2);
        }

        function updateLivesUI() {
            const container = document.getElementById('lives-container');
            container.innerHTML = '';
            for(let i=0; i<lives; i++) container.innerHTML += '<i class="fas fa-heart life-heart"></i>';
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('game-over').style.display = 'flex';
        }

        function watchAd() {
            alert("Loading Rewarded Ad..."); // Replace with AdMob
            lives = 1; updateLivesUI();
            document.getElementById('game-over').style.display = 'none';
            gameActive = true; spawnTarget();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us - Coin Pop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AdMob Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-app-pub-4313544696010088"></script>
    
    <style>
        /* Previous CSS remains the same, adding new ad styles */
        
        /* Enhanced Ad Styles */
        .ad-container {
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 90px;
        }
        
        .fixed-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-color);
            border-top: 1px solid var(--border-color);
            padding: 0.5rem;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .adaptive-banner {
            width: 100%;
            max-width: 728px;
            margin: 1.5rem auto;
        }
        
        .native-ad-container {
            margin: 2rem 0;
            border: 2px dashed var(--primary-color);
            border-radius: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--card-color) 0%, rgba(59, 130, 246, 0.05) 100%);
        }
        
        .interstitial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .interstitial-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            text-align: center;
        }
        
        .interstitial-countdown {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 1rem 0;
        }
        
        .ad-loading {
            background: linear-gradient(90deg, var(--border-color) 25%, var(--card-color) 50%, var(--border-color) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .ad-fallback {
            background: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .ad-performance {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            display: none; /* Hide in production */
        }
    </style>
</head>
<body class="antialiased">
    <div id="app-container" class="w-full flex-grow">
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Your existing sidebar content -->
        </aside>

        <div class="main-content">
            <header class="content-header">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Contact Us</h2>
                <div id="coin-balance-display" class="coin-balance-display">Coins: 0</div>
            </header>

            <main>
                <!-- Adaptive Banner Ad - Top -->
                <div class="ad-container adaptive-banner" id="banner-ad-top">
                    <div class="ad-loading" style="width: 728px; height: 90px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
                        Loading Advertisement...
                    </div>
                    <!-- Ad will be injected here by JavaScript -->
                </div>

                <!-- Hero Section -->
                <div class="contact-hero">
                    <h1>We're Here to Help</h1>
                    <p>Have questions or need assistance? Our support team is ready to help you with any issues or inquiries you might have.</p>
                </div>

                <!-- Contact Information -->
                <div class="contact-info">
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div>
                            <div class="font-semibold">Email Support</div>
                            <div class="text-gray-600 dark:text-gray-400">Send us a message using the form below</div>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div>
                            <div class="font-semibold">Response Time</div>
                            <div class="text-gray-600 dark:text-gray-400">Within 24 hours</div>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div>
                            <div class="font-semibold">Support</div>
                            <div class="text-gray-600 dark:text-gray-400">24/7 Available</div>
                        </div>
                    </div>
                </div>

                <!-- Native Advanced Ad -->
                <div class="native-ad-container" id="native-ad-container">
                    <div class="ad-loading" style="width: 100%; height: 300px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
                        Loading Native Advertisement...
                    </div>
                    <!-- Native ad will be injected here -->
                </div>

                <!-- Tabs for Contact Form and Message History -->
                <div class="tabs">
                    <div class="tab active" data-tab="contact-form">Send Message</div>
                    <div class="tab" data-tab="message-history">My Messages</div>
                    <div class="tab" data-tab="faq">FAQ</div>
                </div>

                <!-- Contact Form Tab -->
                <div class="tab-content active" id="contact-form-tab">
                    <div class="card">
                        <h3 class="card-header">Send us a Message</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Fill out the form below and our support team will get back to you as soon as possible.</p>
                        
                        <!-- Banner Ad within Form Section -->
                        <div class="ad-container adaptive-banner" id="banner-ad-form">
                            <div class="ad-loading" style="width: 468px; height: 60px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
                                Loading Advertisement...
                            </div>
                        </div>
                        
                        <form id="contact-form">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="form-group">
                                    <label class="form-label">Your Name</label>
                                    <input type="text" id="contact-name" class="form-input" placeholder="Enter your name" required>
                                    <div class="form-error" id="name-error">Please enter your name</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Your Email</label>
                                    <input type="email" id="contact-email" class="form-input" placeholder="Enter your email" required>
                                    <div class="form-error" id="email-error">Please enter a valid email address</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subject</label>
                                <select id="contact-subject" class="form-input" required>
                                    <option value="">Select a subject</option>
                                    <option value="general">General Inquiry</option>
                                    <option value="technical">Technical Support</option>
                                    <option value="withdrawal">Withdrawal Issue</option>
                                    <option value="bug">Bug Report</option>
                                    <option value="suggestion">Feature Suggestion</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="form-error" id="subject-error">Please select a subject</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Message</label>
                                <textarea id="contact-message" class="form-textarea" placeholder="Please describe your issue or question in detail..." required></textarea>
                                <div class="form-error" id="message-error">Please enter your message</div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" id="submit-btn">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Send Message
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Message History Tab -->
                <div class="tab-content" id="message-history-tab">
                    <div class="card">
                        <h3 class="card-header">My Messages</h3>
                        
                        <!-- Banner Ad in Message History -->
                        <div class="ad-container adaptive-banner" id="banner-ad-messages">
                            <div class="ad-loading" style="width: 468px; height: 60px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
                                Loading Advertisement...
                            </div>
                        </div>
                        
                        <div id="messages-container">
                            <!-- Messages will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- FAQ Tab -->
                <div class="tab-content" id="faq-tab">
                    <div class="card">
                        <h3 class="card-header">Frequently Asked Questions</h3>
                        
                        <!-- Native Ad in FAQ Section -->
                        <div class="native-ad-container" id="native-ad-faq">
                            <div class="ad-loading" style="width: 100%; height: 250px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
                                Loading Native Advertisement...
                            </div>
                        </div>
                        
                        <div class="space-y-4" id="faq-container">
                            <!-- FAQ items remain the same -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Fixed Banner Ad at Bottom -->
    <div class="fixed-banner" id="fixed-banner-ad">
        <div class="ad-loading" style="width: 320px; height: 50px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
            Loading Advertisement...
        </div>
    </div>

    <!-- Interstitial Ad Overlay -->
    <div class="interstitial-overlay" id="interstitial-overlay">
        <div class="interstitial-content">
            <h3 class="text-xl font-bold mb-4">Advertisement</h3>
            <div class="interstitial-countdown" id="countdown">5</div>
            <p>Thank you for supporting us!</p>
            <p class="text-sm text-gray-600 mt-2">This ad helps keep our service free</p>
            <button id="skip-ad-btn" class="btn btn-primary mt-4">
                Skip Ad
            </button>
        </div>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon"></i>
    </div>

    <script>
        // Enhanced AdMob Manager
        class AdMobManager {
            constructor() {
                this.ads = {
                    banner: 'ca-app-pub-4313544696010088/7463441754',
                    interstitial: 'ca-app-pub-4313544696010088/3524196741',
                    native: 'ca-app-pub-4313544696010088/8580882616'
                };
                this.interstitialAdLoaded = false;
                this.adCounters = {
                    impressions: 0,
                    clicks: 0
                };
                this.init();
            }

            init() {
                this.loadAllAds();
                this.setupAdEventListeners();
                this.startAdRotation();
            }

            loadAllAds() {
                // Load banner ads
                this.loadBannerAd('banner-ad-top', 728, 90);
                this.loadBannerAd('banner-ad-form', 468, 60);
                this.loadBannerAd('banner-ad-messages', 468, 60);
                this.loadFixedBannerAd();
                
                // Load native ads
                this.loadNativeAd('native-ad-container');
                this.loadNativeAd('native-ad-faq');
                
                // Load interstitial
                this.loadInterstitialAd();
            }

            loadBannerAd(containerId, width, height) {
                const container = document.getElementById(containerId);
                if (!container) return;

                setTimeout(() => {
                    const adHTML = `
                        <ins class="adsbygoogle"
                             style="display:inline-block;width:${width}px;height:${height}px"
                             data-ad-client="ca-app-pub-4313544696010088"
                             data-ad-slot="${this.ads.banner}"
                             data-ad-format="auto"
                             data-full-width-responsive="true"></ins>
                        <div class="ad-performance">Banner Ad</div>
                    `;
                    
                    container.innerHTML = adHTML;
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    this.trackImpression('banner');
                    
                }, Math.random() * 2000 + 1000); // Random delay between 1-3 seconds
            }

            loadFixedBannerAd() {
                const container = document.getElementById('fixed-banner-ad');
                if (!container) return;

                setTimeout(() => {
                    const adHTML = `
                        <ins class="adsbygoogle"
                             style="display:inline-block;width:320px;height:50px"
                             data-ad-client="ca-app-pub-4313544696010088"
                             data-ad-slot="${this.ads.banner}"></ins>
                        <div class="ad-performance">Fixed Banner</div>
                    `;
                    
                    container.innerHTML = adHTML;
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    this.trackImpression('banner');
                    
                }, 1500);
            }

            loadNativeAd(containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                setTimeout(() => {
                    const adHTML = `
                        <ins class="adsbygoogle"
                             style="display:block"
                             data-ad-format="fluid"
                             data-ad-layout-key="-fb+5w+4e-db+86"
                             data-ad-client="ca-app-pub-4313544696010088"
                             data-ad-slot="${this.ads.native}"></ins>
                        <div class="ad-performance">Native Ad</div>
                    `;
                    
                    container.innerHTML = adHTML;
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    this.trackImpression('native');
                    
                }, Math.random() * 3000 + 2000); // Random delay between 2-5 seconds
            }

            loadInterstitialAd() {
                console.log('Loading interstitial ad...');
                // Simulate interstitial loading
                setTimeout(() => {
                    this.interstitialAdLoaded = true;
                    console.log('Interstitial ad loaded successfully');
                }, 3000);
            }

            showInterstitialAd() {
                if (!this.interstitialAdLoaded) {
                    console.log('Interstitial not ready, proceeding without ad');
                    return false;
                }

                const overlay = document.getElementById('interstitial-overlay');
                const countdownElement = document.getElementById('countdown');
                let countdown = 5;

                overlay.style.display = 'flex';
                this.trackImpression('interstitial');

                const countdownInterval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        this.closeInterstitial();
                    }
                }, 1000);

                // Skip button functionality
                document.getElementById('skip-ad-btn').onclick = () => {
                    clearInterval(countdownInterval);
                    this.closeInterstitial();
                };

                // Reload interstitial for next use
                this.interstitialAdLoaded = false;
                setTimeout(() => this.loadInterstitialAd(), 5000);

                return true;
            }

            closeInterstitial() {
                const overlay = document.getElementById('interstitial-overlay');
                overlay.style.display = 'none';
                
                // Trigger form submission after ad
                if (window.pendingFormSubmission) {
                    window.pendingFormSubmission();
                    window.pendingFormSubmission = null;
                }
            }

            setupAdEventListeners() {
                // Track ad clicks
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.adsbygoogle')) {
                        this.trackClick();
                    }
                });
            }

            startAdRotation() {
                // Rotate native ads every 30 seconds
                setInterval(() => {
                    this.refreshNativeAds();
                }, 30000);
            }

            refreshNativeAds() {
                const nativeContainers = ['native-ad-container', 'native-ad-faq'];
                nativeContainers.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (container && container.querySelector('.adsbygoogle')) {
                        // Simulate ad refresh
                        console.log(`Refreshing ad in ${containerId}`);
                    }
                });
            }

            trackImpression(type) {
                this.adCounters.impressions++;
                console.log(`Ad Impression: ${type} - Total: ${this.adCounters.impressions}`);
                
                // Here you would send this data to your analytics
                this.updateAdPerformanceDisplay();
            }

            trackClick() {
                this.adCounters.clicks++;
                console.log(`Ad Click - Total: ${this.adCounters.clicks}`);
                
                // Calculate CTR (Click-Through Rate)
                const ctr = this.adCounters.impressions > 0 
                    ? (this.adCounters.clicks / this.adCounters.impressions * 100).toFixed(2)
                    : 0;
                
                console.log(`CTR: ${ctr}%`);
                this.updateAdPerformanceDisplay();
            }

            updateAdPerformanceDisplay() {
                // Update performance displays (for demo purposes)
                document.querySelectorAll('.ad-performance').forEach(el => {
                    el.textContent = `Impressions: ${this.adCounters.impressions} | Clicks: ${this.adCounters.clicks}`;
                });
            }

            getAdStats() {
                return {
                    impressions: this.adCounters.impressions,
                    clicks: this.adCounters.clicks,
                    ctr: this.adCounters.impressions > 0 
                        ? (this.adCounters.clicks / this.adCounters.impressions * 100).toFixed(2)
                        : 0
                };
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize AdMob Manager
            const adManager = new AdMobManager();

            // Your existing application code here (user authentication, form handling, etc.)
            const currentUserEmail = localStorage.getItem('currentUser');
            if (!currentUserEmail) {
                window.location.href = 'index.html';
                return;
            }

            // Load user data and set up UI (your existing code)
            const userData = JSON.parse(localStorage.getItem(`user_${currentUserEmail}`));
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }

            // Update UI elements
            document.getElementById('user-email-display').textContent = currentUserEmail;
            document.getElementById('coin-balance-display').textContent = `Coins: ${userData.coins}`;
            document.getElementById('contact-name').value = userData.name || currentUserEmail.split('@')[0];
            document.getElementById('contact-email').value = currentUserEmail;

            // Enhanced form submission with interstitial ad
            document.getElementById('contact-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validateForm()) {
                    // Store the submission function
                    window.pendingFormSubmission = submitContactForm;
                    
                    // Try to show interstitial ad
                    const adShown = adManager.showInterstitialAd();
                    
                    // If no ad shown, submit immediately
                    if (!adShown) {
                        submitContactForm();
                    }
                }
            });

            // Your existing form validation and submission functions
            function validateForm() {
                // Your existing validation logic
                return true;
            }

            function submitContactForm() {
                // Your existing form submission logic
                console.log('Form submitted successfully');
                showNotification('Thank you for your message! We will get back to you within 24 hours.', 'success');
            }

            function showNotification(message, type) {
                // Your existing notification logic
                console.log(`${type}: ${message}`);
            }

            // Ad performance monitoring (optional)
            setInterval(() => {
                const stats = adManager.getAdStats();
                console.log('Ad Performance:', stats);
            }, 10000);
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard - Coin Pop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-color: #f8fafc;
            --card-color: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }

        .dark-theme {
            --primary-color: #60a5fa;
            --primary-dark: #3b82f6;
            --secondary-color: #a78bfa;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
            --bg-color: #0f172a;
            --card-color: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .sidebar {
            width: 250px;
            background-color: var(--card-color);
            border-right: 1px solid var(--border-color);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
        }

        .nav-link:hover, .nav-link.active {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        .nav-link svg {
            margin-right: 0.75rem;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .logout-btn {
            width: 100%;
            padding: 0.5rem;
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        .main-content {
            margin-left: 250px;
            padding: 2rem;
            min-height: 100vh;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .coin-balance-display {
            background-color: var(--card-color);
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            font-weight: 600;
        }

        .card {
            background-color: var(--card-color);
            border-radius: 1rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .card-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        /* Leaderboard specific styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--card-color), color-mix(in srgb, var(--card-color) 90%, transparent));
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            top: -80px;
            right: -80px;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            bottom: -60px;
            left: -60px;
        }
        
        .payout-card {
            background: linear-gradient(135deg, var(--success-color) 0%, color-mix(in srgb, var(--success-color) 80%, black) 100%);
            color: white;
        }
        
        .rewards-card {
            background: linear-gradient(135deg, var(--warning-color) 0%, color-mix(in srgb, var(--warning-color) 80%, black) 100%);
            color: white;
        }
        
        .progress-bar {
            height: 8px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin-top: 1rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: white;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .stats-inner-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.75rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.75rem;
            opacity: 0.9;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .leaderboard-table th {
            background-color: color-mix(in srgb, var(--bg-color) 50%, transparent);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .leaderboard-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .leaderboard-table tr:hover {
            background-color: color-mix(in srgb, var(--bg-color) 30%, transparent);
        }
        
        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-weight: 700;
            color: white;
        }
        
        .rank-1 {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        .rank-2 {
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
        }
        
        .rank-3 {
            background: linear-gradient(135deg, #CD7F32, #A56C28);
        }
        
        .rank-other {
            background-color: var(--text-secondary);
        }
        
        .player-info {
            display: flex;
            align-items: center;
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 0.75rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .player-name {
            font-weight: 600;
        }
        
        .player-level {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .coins-amount {
            font-weight: 700;
            color: var(--warning-color);
        }
        
        .payout-amount {
            font-weight: 700;
            color: var(--success-color);
        }
        
        .time-filter {
            display: flex;
            background: var(--card-color);
            border-radius: 0.5rem;
            padding: 0.25rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }
        
        .time-option {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        
        .time-option.active {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .payout-info {
            background: color-mix(in srgb, var(--warning-color) 5%, transparent);
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            border-left: 4px solid var(--warning-color);
        }
        
        .floating-coin {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
            z-index: 1;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .coin-1 {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .coin-2 {
            top: 60%;
            right: 15%;
            animation-delay: 1s;
        }
        
        .coin-3 {
            bottom: 20%;
            left: 20%;
            animation-delay: 2s;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .payout-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .payout-item:last-child {
            border-bottom: none;
        }
        
        .payout-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--text-primary);
        }
        
        .payout-details {
            flex: 1;
        }
        
        .payout-title {
            font-weight: 600;
        }
        
        .payout-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .payout-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-completed {
            background: color-mix(in srgb, var(--success-color) 20%, transparent);
            color: var(--success-color);
        }
        
        .status-pending {
            background: color-mix(in srgb, var(--warning-color) 20%, transparent);
            color: var(--warning-color);
        }
        
        .status-failed {
            background: color-mix(in srgb, var(--danger-color) 20%, transparent);
            color: var(--danger-color);
        }
        
        .achievement-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            background: var(--bg-color);
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .achievement-gold {
            background: color-mix(in srgb, var(--warning-color) 20%, transparent);
            color: color-mix(in srgb, var(--warning-color) 80%, black);
        }
        
        .achievement-silver {
            background: color-mix(in srgb, var(--text-secondary) 20%, transparent);
            color: var(--text-secondary);
        }
        
        .achievement-bronze {
            background: color-mix(in srgb, #CD7F32 20%, transparent);
            color: #CD7F32;
        }
        
        .user-highlight {
            background: color-mix(in srgb, var(--primary-color) 10%, transparent) !important;
            border-left: 4px solid var(--primary-color);
        }
        
        .refresh-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
        }
        
        .refresh-btn:hover {
            background: var(--primary-dark);
        }
        
        .refresh-btn:active {
            transform: scale(0.95);
        }
        
        .refresh-btn.rotating {
            animation: rotate 1s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .level-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .level-progress {
            flex: 1;
            margin: 0 1rem;
        }
        
        .level-badge {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .time-filter {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body class="antialiased">
    <div id="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="dashboard.html" class="text-2xl font-bold text-blue-600">Coin Pop</a>
            </div>
            
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-home w-6 h-6"></i>
                    <span>Dashboard</span>
                </a>
                <a href="play.html" class="nav-link">
                    <i class="fas fa-gamepad w-6 h-6"></i>
                    <span>Play</span>
                </a>
                <a href="leaderboard.html" class="nav-link active">
                    <i class="fas fa-trophy w-6 h-6"></i>
                    <span>Leaderboard</span>
                </a>
                <a href="rewards.html" class="nav-link">
                    <i class="fas fa-gift w-6 h-6"></i>
                    <span>Daily Rewards</span>
                </a>
                <a href="withdraw.html" class="nav-link">
                    <i class="fas fa-money-bill-wave w-6 h-6"></i>
                    <span>Withdraw</span>
                </a>
                <a href="admin.html" id="admin-nav-link" class="nav-link" style="display: none;">
                    <i class="fas fa-cog w-6 h-6"></i>
                    <span>Admin</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <div id="user-email-display" class="text-sm truncate">user@example.com</div>
                <button id="logout-btn" class="logout-btn">Sign Out</button>
            </div>
        </aside>

        <div class="main-content">
            <div class="content-header">
                <div>
                    <h1 class="page-title">Leaderboard</h1>
                    <p class="text-secondary mt-1">Compete with players worldwide and climb the ranks!</p>
                </div>
                <div class="header-actions flex items-center">
                    <button id="refresh-btn" class="refresh-btn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                    <div class="coin-balance-display">
                        <i class="fas fa-coins"></i>
                        <span id="coin-balance-display">0 Coins</span>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card stats-card">
                    <div class="floating-coin coin-1"></div>
                    <div class="floating-coin coin-2"></div>
                    <div class="floating-coin coin-3"></div>
                    
                    <h4 class="text-white font-medium opacity-90">Your Ranking</h4>
                    <p class="text-4xl font-bold text-white mt-2" id="user-rank">#0</p>
                    <p class="text-white opacity-80 mt-1" id="user-percentile">Calculating...</p>
                    
                    <div class="stats-inner-grid mt-4">
                        <div class="stat-item">
                            <div class="stat-value" id="total-players">0</div>
                            <div class="stat-label">Total Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="user-coins">0</div>
                            <div class="stat-label">Your Coins</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card payout-card">
                    <h4 class="text-white font-medium opacity-90">Total Payouts</h4>
                    <p class="text-4xl font-bold text-white mt-2" id="total-payouts">PKR 0</p>
                    <p class="text-white opacity-80 mt-1">Distributed to players</p>
                    
                    <div class="stats-inner-grid mt-4">
                        <div class="stat-item">
                            <div class="stat-value" id="payouts-count">0</div>
                            <div class="stat-label">Payments</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">PKR 250</div>
                            <div class="stat-label">Min. Withdrawal</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card rewards-card">
                    <h4 class="text-white font-medium opacity-90">Weekly Rewards</h4>
                    <p class="text-2xl font-bold text-white mt-3">Top 3 Players</p>
                    <p class="text-white opacity-80 mt-1">Bonus coins every week</p>
                    
                    <div class="mt-4">
                        <div class="flex justify-between text-sm">
                            <span>1st: +500 Coins</span>
                            <span>2nd: +300 Coins</span>
                            <span>3rd: +200 Coins</span>
                        </div>
                        <div class="progress-bar mt-2">
                            <div class="progress-fill" id="weekly-progress" style="width: 0%"></div>
                        </div>
                        <p class="text-white opacity-80 text-sm mt-2" id="weekly-reset">Calculating...</p>
                    </div>
                </div>
            </div>

            <!-- Level Progress -->
            <div class="card mb-6">
                <div class="card-header">
                    <i class="fas fa-star text-yellow-500"></i>
                    Your Progress
                </div>
                <div class="level-indicator">
                    <div class="text-sm font-medium" id="current-level-text">Level 1</div>
                    <div class="level-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="level-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="text-sm font-medium" id="next-level-text">Level 2</div>
                    <div class="level-badge" id="current-level">1</div>
                </div>
                <div class="text-center text-sm text-secondary" id="level-progress-text">0/1000 XP to next level</div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="leaderboard">Leaderboard</div>
                <div class="tab" data-tab="payouts">Payout History</div>
                <div class="tab" data-tab="achievements">Achievements</div>
            </div>

            <!-- Time Filter -->
            <div class="time-filter">
                <div class="time-option active" data-time="all">All Time</div>
                <div class="time-option" data-time="weekly">This Week</div>
                <div class="time-option" data-time="monthly">This Month</div>
                <div class="time-option" data-time="daily">Today</div>
            </div>

            <!-- Leaderboard Tab -->
            <div class="tab-content active" id="leaderboard-tab">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-trophy text-yellow-500"></i>
                        Top Players
                    </div>
                    <div class="overflow-x-auto">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Player</th>
                                    <th>Level</th>
                                    <th>Coins</th>
                                    <th>PKR Value</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <!-- Leaderboard data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Payouts Tab -->
            <div class="tab-content" id="payouts-tab">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-money-bill-wave text-green-500"></i>
                        Payout History
                    </div>
                    <div id="payouts-list">
                        <!-- Payout data will be populated by JavaScript -->
                    </div>
                    
                    <div class="payout-info">
                        <p class="text-sm font-medium">Withdrawal Information</p>
                        <p class="text-xs mt-1">1000 Coins = 1 PKR</p>
                        <p class="text-xs">Minimum Withdrawal: PKR 250 (25,000 Coins)</p>
                        <p class="text-xs">Processing Time: 24-48 hours</p>
                    </div>
                </div>
            </div>

            <!-- Achievements Tab -->
            <div class="tab-content" id="achievements-tab">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-medal text-yellow-500"></i>
                            Your Achievements
                        </div>
                        <div id="user-achievements">
                            <!-- User achievements will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-globe text-blue-500"></i>
                            Global Achievements
                        </div>
                        <div id="global-achievements">
                            <!-- Global achievements will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon"></i>
    </div>

    <script>
        // Leaderboard functionality
        document.addEventListener('DOMContentLoaded', function() {
            const currentUserEmail = localStorage.getItem('currentUser');
            if (!currentUserEmail) {
                window.location.href = 'index.html';
                return;
            }

            // Load user data
            const userData = JSON.parse(localStorage.getItem(`user_${currentUserEmail}`));
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }

            // Update UI
            document.getElementById('user-email-display').textContent = currentUserEmail;
            document.getElementById('coin-balance-display').textContent = `Coins: ${userData.coins || 0}`;

            // Show admin link if user is admin
            if (userData.isAdmin) {
                document.getElementById('admin-nav-link').style.display = 'flex';
            }

            // Initialize leaderboard
            initLeaderboard();
            
            // Setup tabs
            setupTabs();
            
            // Setup time filter
            setupTimeFilter();
            
            // Setup refresh button
            document.getElementById('refresh-btn').addEventListener('click', function() {
                refreshLeaderboard();
            });
            
            // Setup theme toggle
            setupThemeToggle();

            // Sign out
            document.getElementById('logout-btn').addEventListener('click', function() {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            });
        });

        // Initialize leaderboard
        function initLeaderboard() {
            updateLeaderboardStats();
            updateLeaderboardTable();
            updatePayouts();
            updateAchievements();
            updateLevelProgress();
        }

        // Refresh leaderboard
        function refreshLeaderboard() {
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.classList.add('rotating');
            
            // Simulate API call delay
            setTimeout(() => {
                updateLeaderboardStats();
                updateLeaderboardTable();
                updatePayouts();
                updateAchievements();
                updateLevelProgress();
                
                refreshBtn.classList.remove('rotating');
            }, 1000);
        }

        // Update leaderboard stats
        function updateLeaderboardStats() {
            const allUsers = getAllUsers();
            const currentUserEmail = localStorage.getItem('currentUser');
            const currentUser = JSON.parse(localStorage.getItem(`user_${currentUserEmail}`) || '{}');
            const userCoins = currentUser.coins || 0;
            
            // Sort users by coins (descending)
            const sortedUsers = allUsers.sort((a, b) => (b.coins || 0) - (a.coins || 0));
            
            // Find user rank
            const userRank = sortedUsers.findIndex(user => user.email === currentUserEmail) + 1;
            const totalPlayers = sortedUsers.length;
            const userPercentile = totalPlayers > 0 ? Math.round(((totalPlayers - userRank) / totalPlayers) * 100) : 0;
            
            // Update stats
            document.getElementById('user-rank').textContent = `#${userRank}`;
            document.getElementById('user-percentile').textContent = `Top ${userPercentile}% of players`;
            document.getElementById('total-players').textContent = totalPlayers;
            document.getElementById('user-coins').textContent = userCoins;
            
            // Calculate total payouts (placeholder - would come from actual payout data)
            const payouts = JSON.parse(localStorage.getItem('payouts') || '[]');
            const totalPayouts = payouts.reduce((sum, payout) => sum + payout.amount, 0);
            document.getElementById('total-payouts').textContent = `PKR ${totalPayouts}`;
            document.getElementById('payouts-count').textContent = payouts.length;
            
            // Update weekly progress
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const daysUntilReset = (7 - dayOfWeek) % 7 || 7;
            const progressPercentage = ((7 - daysUntilReset) / 7) * 100;
            
            document.getElementById('weekly-progress').style.width = `${progressPercentage}%`;
            document.getElementById('weekly-reset').textContent = `${daysUntilReset} days until reset`;
        }

        // Update leaderboard table
        function updateLeaderboardTable() {
            const leaderboardBody = document.getElementById('leaderboard-body');
            const allUsers = getAllUsers();
            const currentUserEmail = localStorage.getItem('currentUser');
            
            // Sort users by coins (descending)
            const sortedUsers = allUsers.sort((a, b) => (b.coins || 0) - (a.coins || 0));
            
            // Clear table
            leaderboardBody.innerHTML = '';
            
            if (sortedUsers.length === 0) {
                leaderboardBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-secondary">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3 class="text-lg font-semibold mb-2">No players yet</h3>
                                <p>Be the first to play and appear on the leaderboard!</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Show top 50 players
            const topPlayers = sortedUsers.slice(0, 50);
            
            topPlayers.forEach((player, index) => {
                const row = document.createElement('tr');
                
                // Check if this is the current user
                const isCurrentUser = player.email === currentUserEmail;
                if (isCurrentUser) {
                    row.classList.add('user-highlight');
                }
                
                // Rank badge
                let rankClass = 'rank-other';
                if (index === 0) rankClass = 'rank-1';
                else if (index === 1) rankClass = 'rank-2';
                else if (index === 2) rankClass = 'rank-3';
                
                // Player avatar initial
                const avatarInitial = (player.name || player.email).charAt(0).toUpperCase();
                
                // Calculate PKR value (1000 coins = 1 PKR)
                const pkrValue = Math.floor((player.coins || 0) / 1000);
                
                row.innerHTML = `
                    <td>
                        <div class="rank-badge ${rankClass}">${index + 1}</div>
                    </td>
                    <td>
                        <div class="player-info">
                            <div class="player-avatar">${avatarInitial}</div>
                            <div>
                                <div class="player-name">${player.name || player.email.split('@')[0]}</div>
                                <div class="player-level">Level ${Math.floor((player.coins || 0) / 1000) + 1}</div>
                            </div>
                        </div>
                    </td>
                    <td>${Math.floor((player.coins || 0) / 1000) + 1}</td>
                    <td class="coins-amount">${(player.coins || 0).toLocaleString()}</td>
                    <td class="payout-amount">PKR ${pkrValue}</td>
                    <td>
                        <span class="payout-status status-completed">Active</span>
                    </td>
                `;
                
                leaderboardBody.appendChild(row);
            });
        }

        // Update payouts
        function updatePayouts() {
            const payoutsList = document.getElementById('payouts-list');
            const payouts = JSON.parse(localStorage.getItem('payouts') || '[]');
            
            // Clear payouts list
            payoutsList.innerHTML = '';
            
            if (payouts.length === 0) {
                payoutsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">No payouts yet</h3>
                        <p>Withdraw your coins to appear here!</p>
                    </div>
                `;
                return;
            }
            
            // Sort payouts by date (newest first)
            payouts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Show recent payouts
            payouts.slice(0, 10).forEach(payout => {
                const payoutItem = document.createElement('div');
                payoutItem.className = 'payout-item';
                
                // Status class
                let statusClass = 'status-completed';
                if (payout.status === 'Pending') statusClass = 'status-pending';
                else if (payout.status === 'Failed') statusClass = 'status-failed';
                
                // Player avatar initial
                const avatarInitial = payout.player.charAt(0).toUpperCase();
                
                payoutItem.innerHTML = `
                    <div class="payout-icon">${avatarInitial}</div>
                    <div class="payout-details">
                        <div class="payout-title">${payout.player}</div>
                        <div class="payout-date">${new Date(payout.date).toLocaleDateString()}</div>
                    </div>
                    <div class="payout-amount">PKR ${payout.amount}</div>
                    <div class="payout-status ${statusClass}">${payout.status}</div>
                `;
                
                payoutsList.appendChild(payoutItem);
            });
        }

        // Update achievements
        function updateAchievements() {
            const userAchievementsContainer = document.getElementById('user-achievements');
            const globalAchievementsContainer = document.getElementById('global-achievements');
            const currentUserEmail = localStorage.getItem('currentUser');
            const currentUser = JSON.parse(localStorage.getItem(`user_${currentUserEmail}`) || '{}');
            
            // Clear containers
            userAchievementsContainer.innerHTML = '';
            globalAchievementsContainer.innerHTML = '';
            
            // User achievements
            const userAchievements = [
                {
                    id: 1,
                    name: "First Coin",
                    description: "Earn your first coin",
                    type: "bronze",
                    earned: (currentUser.coins || 0) > 0
                },
                {
                    id: 2,
                    name: "Coin Collector",
                    description: "Collect 100 coins",
                    type: "silver",
                    earned: (currentUser.coins || 0) >= 100
                },
                {
                    id: 3,
                    name: "Level Up",
                    description: "Reach level 5",
                    type: "silver",
                    earned: Math.floor((currentUser.coins || 0) / 1000) + 1 >= 5
                },
                {
                    id: 4,
                    name: "Balloon Popper",
                    description: "Play 10 games",
                    type: "gold",
                    earned: (currentUser.sessions || 0) >= 10
                },
                {
                    id: 5,
                    name: "Rich Player",
                    description: "Collect 5000 coins",
                    type: "gold",
                    earned: (currentUser.coins || 0) >= 5000
                },
                {
                    id: 6,
                    name: "Top Player",
                    description: "Reach top 10 on leaderboard",
                    type: "gold",
                    earned: false // This would require checking actual rank
                }
            ];
            
            if (userAchievements.filter(a => a.earned).length === 0) {
                userAchievementsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-medal"></i>
                        </div>
                        <p>No achievements earned yet. Keep playing to unlock achievements!</p>
                    </div>
                `;
            } else {
                userAchievements.forEach(achievement => {
                    if (achievement.earned) {
                        const achievementEl = document.createElement('div');
                        achievementEl.className = `achievement-badge achievement-${achievement.type}`;
                        achievementEl.textContent = achievement.name;
                        userAchievementsContainer.appendChild(achievementEl);
                    }
                });
            }
            
            // Global achievements (placeholder)
            const globalAchievements = [
                {
                    id: 1,
                    name: "Millionaire",
                    description: "First player to reach 10,000 coins",
                    player: "ProPlayer99",
                    type: "gold"
                },
                {
                    id: 2,
                    name: "Speed Demon",
                    description: "Complete 10 levels in one day",
                    player: "CoinMaster",
                    type: "silver"
                },
                {
                    id: 3,
                    name: "Consistent Player",
                    description: "Play for 30 consecutive days",
                    player: "BalloonHunter",
                    type: "bronze"
                },
                {
                    id: 4,
                    name: "Lucky Streak",
                    description: "Get 5 daily rewards in a row",
                    player: "LuckyWinner",
                    type: "silver"
                }
            ];
            
            globalAchievements.forEach(achievement => {
                const achievementEl = document.createElement('div');
                achievementEl.className = `achievement-badge achievement-${achievement.type}`;
                achievementEl.textContent = `${achievement.name} - ${achievement.player}`;
                globalAchievementsContainer.appendChild(achievementEl);
            });
        }

        // Update level progress
        function updateLevelProgress() {
            const currentUserEmail = localStorage.getItem('currentUser');
            const currentUser = JSON.parse(localStorage.getItem(`user_${currentUserEmail}`) || '{}');
            const coins = currentUser.coins || 0;
            
            // Simple level system based on coins (1000 coins per level)
            const level = Math.floor(coins / 1000) + 1;
            const levelProgress = (coins % 1000) / 10; // Percentage to next level
            
            document.getElementById('current-level').textContent = level;
            document.getElementById('current-level-text').textContent = `Level ${level}`;
            document.getElementById('next-level-text').textContent = `Level ${level + 1}`;
            document.getElementById('level-progress-bar').style.width = `${levelProgress}%`;
            document.getElementById('level-progress-text').textContent = 
                `${coins % 1000}/1000 XP to Level ${level + 1}`;
        }

        // Get all users from localStorage
        function getAllUsers() {
            const allUsers = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('user_')) {
                    try {
                        const user = JSON.parse(localStorage.getItem(key));
                        allUsers.push(user);
                    } catch (error) {
                        console.error('Error parsing user data:', error);
                    }
                }
            }
            return allUsers;
        }

        // Setup tabs functionality
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }

        // Setup time filter functionality
        function setupTimeFilter() {
            const timeOptions = document.querySelectorAll('.time-option');
            
            timeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove active class from all options
                    timeOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // Add active class to clicked option
                    this.classList.add('active');
                    
                    // In a real app, you would filter the leaderboard based on the selected time
                    const timeFilter = this.getAttribute('data-time');
                    console.log(`Filtering by: ${timeFilter}`);
                    // updateLeaderboardWithFilter(timeFilter);
                });
            });
        }

        // Setup theme toggle
        function setupThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');

            function initTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-theme');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.body.classList.remove('dark-theme');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
            }

            themeToggle.addEventListener('click', function() {
                if (document.body.classList.contains('dark-theme')) {
                    document.body.classList.remove('dark-theme');
                    localStorage.setItem('theme', 'light');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    document.body.classList.add('dark-theme');
                    localStorage.setItem('theme', 'dark');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
            });

            initTheme();
        }
    </script>
</body>
</html>
/* Remove specific floating coins */
.coin-1,
.coin-2,
.coin-3 {
    display: none !important;
}

<script type="module">
    // --- State Management ---
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || { email: 'Guest', coins: 0 };
    
    // --- DOM Elements ---
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const sidebar = document.querySelector('.sidebar');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const contactForm = document.getElementById('contact-form');
    const faqQuestions = document.querySelectorAll('.faq-question');

    // --- Sidebar Toggle ---
    mobileMenuBtn.addEventListener('click', () => {
        sidebar.classList.toggle('active');
    });

    // --- Tab Switching Logic ---
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const target = tab.getAttribute('data-tab');
            
            // Update UI
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            tab.classList.add('active');
            document.getElementById(`${target}-tab`).classList.add('active');
        });
    });

    // --- FAQ Accordion ---
    faqQuestions.forEach(question => {
        question.addEventListener('click', () => {
            const answer = question.nextElementSibling;
            const icon = question.querySelector('.faq-toggle');
            
            answer.classList.toggle('open');
            icon.classList.toggle('open');
        });
    });

    // --- Form Submission & Validation ---
    contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submit-btn');
        const originalContent = submitBtn.innerHTML;
        
        // Simple visual loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = `<span class="loading-spinner"></span> Sending...`;

        // Simulate API Call
        setTimeout(() => {
            showNotification('Message sent successfully! We will contact you soon.', 'success');
            contactForm.reset();
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalContent;
            
            // Optional: Move user to "My Messages" tab to see the history
            document.querySelector('[data-tab="message-history"]').click();
        }, 1500);
    });

    // --- Helper: Notifications ---
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type} show`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'}"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // --- Initialization ---
    function init() {
        document.getElementById('user-email-display').textContent = currentUser.email;
        document.getElementById('coin-balance-display').textContent = `Coins: ${currentUser.coins.toLocaleString()}`;
        
        // Populate "My Messages" with empty state if none exist
        const container = document.getElementById('messages-container');
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-comment-slash empty-state-icon"></i>
                <p>No messages found. Send us a message if you need help!</p>
            </div>
        `;
    }

    init();
</script>
